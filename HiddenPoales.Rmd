---
title: "HiddenPoales"
author: "Marcial Escudero"
date: '2022-10-07'
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r}

#install.packages("corHMM")
library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
tree

trait1 <- cbind(traits$WCVP_name, traits$open_closed)
#open_closed
trait1
trait1[,2][trait1[,2] == ""] <- NA
trait1[,2][trait1[,2] == "1"] <- 1
trait1[,2][trait1[,2] == "0"] <- 0
trait1[,2][trait1[,2] == "01"] <- 1
trait1<-trait1[!is.na(trait1[,2]),]
tipstoremove <- setdiff(tree$tip.label,trait1[,1])
mytree <- drop.tip(tree, tipstoremove)

pp.polymorphic<-corHMM(mytree,trait1,rate.cat=2,node.states="marginal")
pp.polymorphic
pp.polymorphic.1<-corHMM(mytree,trait1,rate.cat=1,node.states="marginal")
pp.polymorphic.1
pp.polymorphic.2<-corHMM(mytree,trait1,rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic.2
pp.polymorphic.3<-corHMM(mytree,trait1,rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic.3


pdffn = paste0("corHMMmodel_open_closed.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic, rate.cat = 2, color = c("orange", "blue"))
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2rates_open_closed.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Polymorphic ARD and R1/R2 rates")
dev.off()

trait <- trait1[,2]
names(trait) <- trait1[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_open_closed.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closed.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan",cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()


```
```{r}
#install.packages("corHMM")
library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
tree

trait2 <- cbind(traits$WCVP_name, traits$C4)
#C4
trait2
trait2[,2][trait2[,2] == ""] <- NA
trait2[,2][trait2[,2] == "1"] <- 1
trait2[,2][trait2[,2] == "0"] <- 0
trait2[,2][trait2[,2] == "01"] <- 1
trait2<-trait2[!is.na(trait2[,2]),]
tipstoremove <- setdiff(tree$tip.label,trait2[,1])
mytree <- drop.tip(tree, tipstoremove)

pp.polymorphic2<-corHMM(mytree,trait2,rate.cat=2,node.states="marginal")
pp.polymorphic2
pp.polymorphic2.1<-corHMM(mytree,trait2,rate.cat=1,node.states="marginal")
pp.polymorphic2.1
pp.polymorphic2.2<-corHMM(mytree,trait2,rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic2.2
pp.polymorphic2.3<-corHMM(mytree,trait2,rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic2.3


pdffn = paste0("corHMMmodel_c4.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic2, rate.cat = 2, color = c("orange", "blue"))
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2rates_c4.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic2$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Polymorphic ARD and R1/R2 rates")
dev.off()

trait <- trait2[,2]
names(trait) <- trait2[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_c4.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic2$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2ratesfan_c4.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan",cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic2$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

```


```{r}
#install.packages("corHMM")
library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
tree

trait3 <- cbind(traits$WCVP_name, traits$wind_animal)
#wind_animal
trait3
trait3[,2][trait3[,2] == ""] <- NA
trait3[,2][trait3[,2] == "1"] <- 1
trait3[,2][trait3[,2] == "0"] <- 0
trait3[,2][trait3[,2] == "01"] <- 1
trait3<-trait3[!is.na(trait3[,2]),]
tipstoremove <- setdiff(tree$tip.label,trait3[,1])
mytree <- drop.tip(tree, tipstoremove)

pp.polymorphic3<-corHMM(mytree,trait3,rate.cat=2,node.states="marginal")
pp.polymorphic3
pp.polymorphic3.1<-corHMM(mytree,trait3,rate.cat=1,node.states="marginal")
pp.polymorphic3.1
pp.polymorphic3.2<-corHMM(mytree,trait3,rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic3.2
pp.polymorphic3.3<-corHMM(mytree,trait3,rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic3.3


pdffn = paste0("corHMMmodel_wind_animal.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic3.2, rate.cat = 2, color = c("orange", "blue"))
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicSYMandR1R2rates_wind_animal.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic3.2$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Polymorphic SYM and R1/R2 rates")
dev.off()

trait <- trait3[,2]
names(trait) <- trait3[,1]
pdffn = paste0("polymorphicSYMandR1R2ratesv2_wind_animal.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic3.2$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicSYMandR1R2ratesfan_wind_animal.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan",cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic3.2$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()
```



```{r}
#install.packages("corHMM")
library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
tree

trait4 <- cbind(traits$WCVP_name, traits$annual_perennial)
#annual_perennial
trait4
trait4[,2][trait4[,2] == ""] <- NA
trait4[,2][trait4[,2] == "1"] <- 1
trait4[,2][trait4[,2] == "0"] <- 0
trait4[,2][trait4[,2] == "01"] <- 1
trait4<-trait4[!is.na(trait4[,2]),]
tipstoremove <- setdiff(tree$tip.label,trait4[,1])
mytree <- drop.tip(tree, tipstoremove)

pp.polymorphic4<-corHMM(mytree,trait4,rate.cat=2,node.states="marginal")
pp.polymorphic4
pp.polymorphic4.1<-corHMM(mytree,trait4,rate.cat=1,node.states="marginal")
pp.polymorphic4.1
pp.polymorphic4.2<-corHMM(mytree,trait4,rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic4.2
pp.polymorphic4.3<-corHMM(mytree,trait4,rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic4.3


pdffn = paste0("corHMMmodel_annual_perennial.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic4, rate.cat = 2, color = c("orange", "blue"))
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2rates_annual_perennial.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic4$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Polymorphic ARD and R1/R2 rates")
dev.off()

trait <- trait4[,2]
names(trait) <- trait4[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_annual_perennial.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic4$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2ratesfan_annual_perennial.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan",cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic4$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

```




```{r}
#install.packages("corHMM")
library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
tree

trait5 <- cbind(traits$WCVP_name, traits$CAM)
#CAM
trait5
trait5[,2][trait5[,2] == ""] <- NA
trait5[,2][trait5[,2] == "1"] <- 1
trait5[,2][trait5[,2] == "0"] <- 0
trait5[,2][trait5[,2] == "01"] <- 1
trait5<-trait5[!is.na(trait5[,2]),]
tipstoremove <- setdiff(tree$tip.label,trait5[,1])
mytree <- drop.tip(tree, tipstoremove)

pp.polymorphic5<-corHMM(mytree,trait5,rate.cat=2,node.states="marginal")
pp.polymorphic5
pp.polymorphic5.1<-corHMM(mytree,trait5,rate.cat=1,node.states="marginal")
pp.polymorphic5.1
pp.polymorphic5.2<-corHMM(mytree,trait5,rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic5.2
pp.polymorphic5.3<-corHMM(mytree,trait5,rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic5.3


pdffn = paste0("corHMMmodel_CAM.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic5, rate.cat = 2, color = c("orange", "blue"))
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2rates_CAM.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic5$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Polymorphic ARD and R1/R2 rates")
dev.off()

trait <- trait5[,2]
names(trait) <- trait5[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_CAM.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic5$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2ratesfan_CAM.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan",cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic5$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

```



```{r}
#install.packages("corHMM")
library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
tree

trait6 <- cbind(traits$WCVP_name, traits$silica)
#silica
trait6
trait6[,2][trait6[,2] == ""] <- NA
trait6[,2][trait6[,2] == "1"] <- 1
trait6[,2][trait6[,2] == "0"] <- 0
trait6[,2][trait6[,2] == "01"] <- 1
trait6<-trait6[!is.na(trait6[,2]),]
tipstoremove <- setdiff(tree$tip.label,trait6[,1])
mytree <- drop.tip(tree, tipstoremove)

pp.polymorphic6<-corHMM(mytree,trait6,rate.cat=2,node.states="marginal")
pp.polymorphic6
pp.polymorphic6.1<-corHMM(mytree,trait6,rate.cat=1,node.states="marginal")
pp.polymorphic6.1
pp.polymorphic6.2<-corHMM(mytree,trait6,rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic6.2
pp.polymorphic6.3<-corHMM(mytree,trait6,rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic6.3

pdffn = paste0("corHMMmodel_CAM.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic5, rate.cat = 2, color = c("orange", "blue"))
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2rates_CAM.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic5$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Polymorphic ARD and R1/R2 rates")
dev.off()

trait <- trait5[,2]
names(trait) <- trait5[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_CAM.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic5$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "red", "yellow")
pdffn = paste0("polymorphicARDandR1R2ratesfan_CAM.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan",cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic5$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

```
