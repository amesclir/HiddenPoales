---
title: "HiddenPoales"
author: "Marcial Escudero"
date: '2022-10-07'
output: html_document
editor_options: 
  chunk_output_type: console
---



More complex models with openclosed, annualperennial and photosynthesis

```{r}
#install.packages("corHMM")

library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
mytree <- read.tree(file="final_tree.tree")
mytree

trait1 <- cbind(traits$WCVP_name, traits$open_closed)
trait4 <- cbind(traits$WCVP_name, traits$annual_perennial)
trait11 <- cbind(traits$WCVP_name, traits$C4)
trait5 <- cbind(traits$WCVP_name, traits$CAM)
trait11[,2][trait11[,2] == ""] <- NA
trait11[,2][trait5[,2] == 1] <- 2
trait11[,2][trait11[,2] == "1"] <- 1
trait11[,2][trait11[,2] == "0"] <- 0
trait11[,2][trait11[,2] == "01"] <- 1
trait1[,2][trait1[,2] == ""] <- NA
trait1[,2][trait1[,2] == "1"] <- 1
trait1[,2][trait1[,2] == "0"] <- 0
trait1[,2][trait1[,2] == "01"] <- 1
trait4[,2][trait4[,2] == ""] <- NA
trait4[,2][trait4[,2] == "1"] <- 1
trait4[,2][trait4[,2] == "0"] <- 0
trait4[,2][trait4[,2] == "01"] <- 1
trait12 <- cbind(trait1, trait4,trait11)
trait12 <- trait12[,c(1,2,4,6)]
trait12<-trait12[!is.na(trait12[,2]),]
trait12<-trait12[!is.na(trait12[,3]),]
trait12<-trait12[!is.na(trait12[,4]),]

tipstoremove <- setdiff(mytree$tip.label,trait12[,1])

mytree <- drop.tip(mytree, tipstoremove)

setdiff(trait12[,1], mytree$tip.label)
setdiff(mytree$tip.label,trait12[,1])

pp.polymorphic12a<-corHMM(mytree,trait12[,c(1,2,3)],rate.cat=2,node.states="marginal")
pp.polymorphic12a
pp.polymorphic12a.1<-corHMM(mytree,trait12[,c(1,2,3)],rate.cat=1,node.states="marginal")
pp.polymorphic12a.1
pp.polymorphic12a.2<-corHMM(mytree,trait12[,c(1,2,3)],rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic12a.2
pp.polymorphic12a.3<-corHMM(mytree,trait12[,c(1,2,3)],rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic12a.3

pp.polymorphic12a.4<-corHMM(mytree,trait12[,c(1,2,3)],rate.cat=3, node.states="marginal")
pp.polymorphic12a.4

LegendAndRateMat <- getStateMat4Dat(trait12[,c(1,2,4)])
LegendAndRateMat
RateMat <- LegendAndRateMat$rate.mat
RateMat
RateMat[2,3] <- 0
RateMat[3,2] <- 0
RateMat[5,6] <- 0
RateMat[6,5] <- 0
RateMat[5,2] <- 5
RateMat[1,3] <- 6
RateMat[6,3] <- 7
RateMat[1,4] <- 8
RateMat[5,4] <- 9
RateMat[6,4] <- 10
RateMat[2,5] <- 11
RateMat[4,5] <- 12
RateMat[2,5] <- 11
RateMat[4,5] <- 12
RateMat[3,6] <- 13
RateMat[4,6] <- 14
RateMat
RateClassMat <- getRateCatMat(2) #
RateClassMat <- equateStateMatPars(RateClassMat, c(1,2))
RateClassMat
StateMats <- list(RateMat, RateMat)
StateMats
FullMat <- getFullMat(StateMats, RateClassMat)
FullMat
RateMatsym <- RateMat
RateMatsym
RateMatsym[5,4] <- 1
RateMatsym[6,4] <- 2
RateMatsym[4,5] <- 4
RateMatsym[4,6] <- 6
RateMatsym[1,4] <- 3
RateMatsym[2,5] <- 5
RateMatsym[3,6] <- 7
RateMatsym
StateMatssym <- list(RateMatsym, RateMatsym)
StateMatssym
FullMatsym <- getFullMat(StateMatssym, RateClassMat)
FullMatsym
pp.polymorphic12b<-corHMM(mytree,trait12[,c(1,2,4)],rate.cat=2,rate.mat = FullMat, node.states="marginal")
pp.polymorphic12b
pp.polymorphic12b.1<-corHMM(mytree,trait12[,c(1,2,4)],rate.cat=1,rate.mat = RateMat, node.states="marginal")
pp.polymorphic12b.1
pp.polymorphic12b.2<-corHMM(mytree,trait12[,c(1,2,4)],rate.cat=2, rate.mat = FullMatsym, node.states="marginal")
pp.polymorphic12b.2
pp.polymorphic12b.3<-corHMM(mytree,trait12[,c(1,2,4)],rate.cat=1,rate.mat = RateMatsym, node.states="marginal")
pp.polymorphic12b.3

RateMat
RateClassMat3 <- getRateCatMat(3) #
RateClassMat3 <- equateStateMatPars(RateClassMat3, c(1,2,3,4,5,6))
RateClassMat3
StateMats3 <- list(RateMat, RateMat,RateMat)
StateMats3
FullMat3 <- getFullMat(StateMats3, RateClassMat3)
FullMat3

pp.polymorphic12b.4<-corHMM(mytree,trait12[,c(1,2,4)],rate.cat=3,rate.mat = FullMat3, node.states="marginal")
pp.polymorphic12b.4

RateMat
RateClassMat2 <- getRateCatMat(2) #
RateClassMat2
StateMats2 <- list(RateMat, RateMat)
StateMats2
FullMat2 <- getFullMat(StateMats2, RateClassMat2)
FullMat2

pp.polymorphic12b.5<-corHMM(mytree,trait12[,c(1,2,4)],rate.cat=2,rate.mat = FullMat2, node.states="marginal")
pp.polymorphic12b.5


RateMat
RateClassMat3b <- getRateCatMat(3) #
RateClassMat3b
StateMats3b <- list(RateMat, RateMat,RateMat)
StateMats3b
FullMat3b <- getFullMat(StateMats3b, RateClassMat3b)
FullMat3b

pp.polymorphic12b.6<-corHMM(mytree,trait12[,c(1,2,4)],rate.cat=3,rate.mat = FullMat3b, node.states="marginal")
pp.polymorphic12b.6

pp.polymorphic12c<-corHMM(mytree,trait12[,c(1,2)],rate.cat=2,node.states="marginal")
pp.polymorphic12c
pp.polymorphic12c.1<-corHMM(mytree,trait12[,c(1,2)],rate.cat=1,node.states="marginal")
pp.polymorphic12c.1
pp.polymorphic12c.2<-corHMM(mytree,trait12[,c(1,2)],rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic12c.2
pp.polymorphic12c.3<-corHMM(mytree,trait12[,c(1,2)],rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic12c.3

pp.polymorphic12d<-corHMM(mytree,trait12[,c(1,3)],rate.cat=2,node.states="marginal")
pp.polymorphic12d
pp.polymorphic12d.1<-corHMM(mytree,trait12[,c(1,3)],rate.cat=1,node.states="marginal")
pp.polymorphic12d.1
pp.polymorphic12d.2<-corHMM(mytree,trait12[,c(1,3)],rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic12d.2
pp.polymorphic12d.3<-corHMM(mytree,trait12[,c(1,3)],rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic12d.3

LegendAndRateMat <- getStateMat4Dat(trait12[,c(1,4)])
RateMat <- LegendAndRateMat$rate.mat
RateMat
RateMat[2,3] <- 0
RateMat[3,2] <- 0
RateMat[1,3] <- 4
RateMat
RateClassMat <- getRateCatMat(2) #
RateClassMat <- equateStateMatPars(RateClassMat, c(1,2))
RateClassMat
StateMats <- list(RateMat, RateMat)
StateMats
FullMat <- getFullMat(StateMats, RateClassMat)
FullMat
RateMatsym <- RateMat
RateMatsym[1,2] <- 1
RateMatsym[1,3] <- 2
RateMatsym
StateMatssym <- list(RateMatsym, RateMatsym)
StateMatssym
FullMatsym <- getFullMat(StateMatssym, RateClassMat)
FullMatsym
pp.polymorphic12e<-corHMM(mytree,trait12[,c(1,4)],rate.cat=2, rate.mat = FullMat, node.states="marginal")
pp.polymorphic12e
pp.polymorphic12e.1<-corHMM(mytree,trait12[,c(1,4)],rate.cat=1,rate.mat = RateMat, node.states="marginal")
pp.polymorphic12e.1
pp.polymorphic12e.2<-corHMM(mytree,trait12[,c(1,4)],rate.cat=2, rate.mat = FullMatsym, node.states="marginal")
pp.polymorphic12e.2
pp.polymorphic12e.3<-corHMM(mytree,trait12[,c(1,4)],rate.cat=1, rate.mat = RateMatsym, node.states="marginal")
pp.polymorphic12e.3

#open_close_C3C4CAM
pdffn = paste0("corHMMmodel_open_close_C3C4CAM.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic12b.6, rate.cat = 3, color = "col.blind" )
dev.off()
#"0_0" "0_1" "0_2" "1_0" "1_1" "1_2" 
cols <- c(
  # Base colors
  "#FF0000", "#0000FF", "#008000", "#FFA500", "#800080", "#FFD700", # red, blue, green, orange, purple, yellow
  
  # Darker versions (much darker for contrast)
  "#660000", "#000066", "#003300", "#CC7000", "#4B004B", "#B8860B", # darkred, darkblue, darkgreen, darkorange, darkpurple, darkyellow
  
  # Lighter versions (much lighter for contrast)
  "#FFB3B3", "#B3D1FF", "#B3FFB3", "#FFE0B3", "#E6B3E6", "#FFFFCC"  # lightred, lightblue, lightgreen, lightorange, lightpurple, lightyellow
)


trait <- paste(trait12[,2],trait12[,4], sep = "_") 
names(trait) <- trait12[,1]

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAM.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAM.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
dev.off()

#"0_0" "0_1" "0_2" "1_0" "1_1" "1_2" 
#open_close_C3C4CAM
#(1,R1)       (2,R1)       (3,R1)      (4,R1)       (5,R1)       (6,R1)    (1,R2) (2,R2)       (3,R2)       (4,R2)       (5,R2)       (6,R2) and the third rate
cols <- c("orange", "orange", "orange", "orange", "orange", "orange", "grey", "grey", "grey", "grey", "grey", "grey","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAMrates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAMrates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
dev.off()

#"0_0" "0_1" "0_2" "1_0" "1_1" "1_2" 
#open_close_C3C4CAM
#(1,R1)       (2,R1)       (3,R1)      (4,R1)       (5,R1)       (6,R1)    (1,R2) (2,R2)       (3,R2)       (4,R2)       (5,R2)       (6,R2) and the third rate
cols <- c("green", "blue", "red", "green", "blue", "red", "green", "blue", "red",  "green", "blue", "red","green", "blue", "red", "green", "blue", "red")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAMphoto.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAMphoto.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
dev.off()

#"0_0" "0_1" "0_2" "1_0" "1_1" "1_2" 
#open_close_C3C4CAM
#(1,R1)       (2,R1)       (3,R1)      (4,R1)       (5,R1)       (6,R1)    (1,R2) (2,R2)       (3,R2)       (4,R2)       (5,R2)       (6,R2)
cols <- c("pink", "pink", "pink", "brown", "brown", "brown", "pink", "pink", "pink", "brown", "brown", "brown", "pink", "pink", "pink", "brown", "brown", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAMhabitats.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_C3C4CAMhabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12b.6$states,piecol=cols,cex=0.1)
dev.off()

#open_close_annual_perennial
pdffn = paste0("corHMMmodel_open_close_annual_perennial.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic12a.4, rate.cat = 3, color = "col.blind" )
dev.off()

trait <- paste(trait12[,2],trait12[,3], sep = "_") 
names(trait) <- trait12[,1]

cols <- c(
  # Base colors
  "#FF0000", "#0000FF", "#008000", "#FFA500", # red, blue, green, orange, purple, yellow
  
  # Darker versions (much darker for contrast)
  "#660000", "#000066", "#003300", "#CC7000", # darkred, darkblue, darkgreen, darkorange, darkpurple, darkyellow
  
  # Lighter versions (much lighter for contrast)
  "#FFB3B3", "#B3D1FF", "#B3FFB3", "#FFE0B3"  # lightred, lightblue, lightgreen, lightorange, lightpurple, lightyellow
)
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_annual_perennial.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12a.4$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_annual_perennial.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12a.4$states,piecol=cols,cex=0.1)
dev.off()

#1     2     3     4 
#"0_0" "0_1" "1_0" "1_1" 
#(1,R1)      (2,R1)      (3,R1)       (4,R1)      (1,R2)      (2,R2)      (3,R2)  (4,R2) and the third rate

cols <- c("orange", "orange", "orange", "orange", "grey", "grey", "grey", "grey", "darkblue", "darkblue", "darkblue", "darkblue")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_annual_perennialrates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12a.4$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_annual_perennialrates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12a.4$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("pink", "pink", "brown", "brown", "pink", "pink", "brown", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_annual_perennialhabitat.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12a.4$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_annual_perennialhabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12a.4$states,piecol=cols,cex=0.1)
dev.off()




#open_close

pdffn = paste0("corHMMmodel_open_closed.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic12c, rate.cat = 2, color = "col.blind")
dev.off()

cols <- c("red", "yellow","white", "black")
pdffn = paste0("polymorphicARDandR1R2rates_open_closed.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic12c$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Open Close ARD and R1/R2 rates")
dev.off()

trait <- trait12[,2]
names(trait) <- trait12[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_open_closed.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("red", "yellow","white", "black")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closed.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closed.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
dev.off()


# 1   2 
#"0" "1" 
# (1,R1)      (2,R1)     (1,R2)      (2,R2)
cols <- c("orange", "orange", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closerates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closerates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("pink", "brown", "pink", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closehabitat.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closehabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
dev.off()

#annual_perennial
pdffn = paste0("corHMMmodel_annual_perennial.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic12d, rate.cat = 2, color = "col.blind")
dev.off()

cols <- c("red", "yellow","white", "black")
pdffn = paste0("polymorphicARDandR1R2rates_annual_perennial.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic12d$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Annual Perennial ARD and R1/R2 rates")
dev.off()

trait <- trait12[,3]
names(trait) <- trait12[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_annual_perennial.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12d$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("red", "yellow","white", "black")
pdffn = paste0("polymorphicARDandR1R2ratesfan_annual_perennial.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12d$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()


pdffn = paste0("polymorphicARDandR1R2ratesfan_annual_perennial.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12d$states,piecol=cols,cex=0.1)
dev.off()


cols <- c("orange", "orange", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_annual_perennialrates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12d$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()


pdffn = paste0("polymorphicARDandR1R2ratesfan_annual_perennialrates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12d$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("green", "blue", "green", "blue")
pdffn = paste0("polymorphicARDandR1R2ratesfan_annual_perennialhabit.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12d$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()


pdffn = paste0("polymorphicARDandR1R2ratesfan_annual_perennialhabit.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12d$states,piecol=cols,cex=0.1)
dev.off()

#photosynthesis

pdffn = paste0("corHMMmodel_C3C4CAM.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic12e, rate.cat = 2, color = "col.blind" )
dev.off()

cols <- c("white", "black", "blue", "red", "yellow", "orange")
pdffn = paste0("polymorphicARDandR1R2rates_C3C4CAM.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic12e$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="C3C4CAM ARD and R1/R2 rates")
dev.off()

trait <- trait12[,4]
names(trait) <- trait12[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_C3C4CAM.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12e$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "blue", "red", "yellow", "orange")
pdffn = paste0("polymorphicARDandR1R2ratesfan_C3C4CAM.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12e$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_C3C4CAM.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12e$states,piecol=cols,cex=0.1)
dev.off()

# 1   2   3 
#"0" "1" "2" 
# (1,R1)      (2,R1)       (3,R1)      (1,R2)      (2,R2)      (3,R2)

cols <- c("orange", "orange", "orange", "grey", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_C3C4CAMrates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12e$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_C3C4CAMrates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12e$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("green", "blue", "red", "green", "blue", "red")
pdffn = paste0("polymorphicARDandR1R2ratesfan_C3C4CAMphoto.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12e$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_C3C4CAMphoto.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12e$states,piecol=cols,cex=0.1)
dev.off()
```



More complex models with openclose,  pollination (wind/animal), wetness (wet/dry), growth (epiphyte/not) and silica (+/-)

```{r}
#install.packages("corHMM")

library(corHMM)
library(phytools)

load("hisse.RData")
ls()
traits
mytree <- read.tree(file="final_tree.tree")
mytree

trait1 <- cbind(traits$WCVP_name, traits$open_closed)
trait5 <- cbind(traits$WCVP_name, traits$wind_animal)
trait6 <- cbind(traits$WCVP_name, traits$silica)
trait7 <- cbind(traits$WCVP_name, traits$wet)
trait9 <- cbind(traits$WCVP_name, traits$epiphyte)

trait1[,2][trait1[,2] == ""] <- NA
trait1[,2][trait1[,2] == "1"] <- 1
trait1[,2][trait1[,2] == "0"] <- 0
trait1[,2][trait1[,2] == "01"] <- 1
trait5[,2][trait5[,2] == ""] <- NA
trait5[,2][trait5[,2] == "1"] <- 1
trait5[,2][trait5[,2] == "0"] <- 0
trait5[,2][trait5[,2] == "01"] <- 1
trait6[,2][trait6[,2] == ""] <- NA
trait6[,2][trait6[,2] == "1"] <- 1
trait6[,2][trait6[,2] == "0"] <- 0
trait6[,2][trait6[,2] == "01"] <- 1
trait7[,2][trait7[,2] == ""] <- NA
trait7[,2][trait7[,2] == "1"] <- 1
trait7[,2][trait7[,2] == "0"] <- 0
trait7[,2][trait7[,2] == "01"] <- 1
trait9[,2][trait9[,2] == ""] <- NA
trait9[,2][trait9[,2] == "1"] <- 1
trait9[,2][trait9[,2] == "0"] <- 0
trait9[,2][trait9[,2] == "01"] <- 1

trait13 <- cbind(trait1, trait5,trait6,trait7,trait9)
trait13 <- trait13[,c(1,2,4,6,8,10)]
trait13<-trait13[!is.na(trait13[,2]),]
trait13<-trait13[!is.na(trait13[,3]),]
trait13<-trait13[!is.na(trait13[,4]),]
trait13<-trait13[!is.na(trait13[,5]),]
trait13<-trait13[!is.na(trait13[,6]),]

tipstoremove <- setdiff(mytree$tip.label,trait13[,1])

mytree <- drop.tip(mytree, tipstoremove)

setdiff(trait13[,1], mytree$tip.label)
setdiff(mytree$tip.label,trait13[,1])

pp.polymorphic13a<-corHMM(mytree,trait13[,c(1,2,3)],rate.cat=2,node.states="marginal")
pp.polymorphic13a
pp.polymorphic13a.1<-corHMM(mytree,trait13[,c(1,2,3)],rate.cat=1,node.states="marginal")
pp.polymorphic13a.1
pp.polymorphic13a.2<-corHMM(mytree,trait13[,c(1,2,3)],rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic13a.2
pp.polymorphic13a.3<-corHMM(mytree,trait13[,c(1,2,3)],rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic13a.3

pp.polymorphic13a.4<-corHMM(mytree,trait13[,c(1,2,3)],rate.cat=3,node.states="marginal")
pp.polymorphic13a.4


pp.polymorphic13b<-corHMM(mytree,trait13[,c(1,2,4)],rate.cat=2,node.states="marginal")
pp.polymorphic13b
pp.polymorphic13b.1<-corHMM(mytree,trait13[,c(1,2,4)],rate.cat=1,node.states="marginal")
pp.polymorphic13b.1
pp.polymorphic13b.2<-corHMM(mytree,trait13[,c(1,2,4)],rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic13b.2
pp.polymorphic13b.3<-corHMM(mytree,trait13[,c(1,2,4)],rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic13b.3

pp.polymorphic13b.4<-corHMM(mytree,trait13[,c(1,2,4)],rate.cat=3,node.states="marginal")
pp.polymorphic13b.4


pp.polymorphic13c<-corHMM(mytree,trait13[,c(1,2,5)],rate.cat=2,node.states="marginal")
pp.polymorphic13c
pp.polymorphic13c.1<-corHMM(mytree,trait13[,c(1,2,5)],rate.cat=1,node.states="marginal")
pp.polymorphic13c.1
pp.polymorphic13c.2<-corHMM(mytree,trait13[,c(1,2,5)],rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic13c.2
pp.polymorphic13c.3<-corHMM(mytree,trait13[,c(1,2,5)],rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic13c.3

pp.polymorphic13c.4<-corHMM(mytree,trait13[,c(1,2,5)],rate.cat=3,node.states="marginal")
pp.polymorphic13c.4


pp.polymorphic13d<-corHMM(mytree,trait13[,c(1,2,6)],rate.cat=2,node.states="marginal")
pp.polymorphic13d
pp.polymorphic13d.1<-corHMM(mytree,trait13[,c(1,2,6)],rate.cat=1,node.states="marginal")
pp.polymorphic13d.1
pp.polymorphic13d.2<-corHMM(mytree,trait13[,c(1,2,6)],rate.cat=2, model = "SYM", node.states="marginal")
pp.polymorphic13d.2
pp.polymorphic13d.3<-corHMM(mytree,trait13[,c(1,2,6)],rate.cat=1,model = "SYM", node.states="marginal")
pp.polymorphic13d.3

pp.polymorphic13d.4<-corHMM(mytree,trait13[,c(1,2,6)],rate.cat=3,node.states="marginal")
pp.polymorphic13d.4



#open_close_wind_animal
pdffn = paste0("corHMMmodel_open_close_wind_animal.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic13a, rate.cat = 2, color = "col.blind" )
dev.off()

#"0_0" "0_1" "1_0" "1_1" 
cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2rates_open_close_wind_animal.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic13a$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Open Close Wind Animal ARD and R1/R2 rates")
dev.off()

trait <- paste(trait13[,2],trait13[,3], sep = "_") 
names(trait) <- trait13[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_open_close_wind_animal.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animal.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animal.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
dev.off()

#1     2     3     4 
#"0_0" "0_1" "1_0" "1_1" 
#(1,R1)      (2,R1)      (3,R1)       (4,R1)      (1,R2)      (2,R2)      (3,R2)  (4,R2)

cols <- c("orange", "orange", "orange", "orange", "grey", "grey", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animalrates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animalrates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("pink", "pink", "brown", "brown", "pink", "pink", "brown", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animalhabitat.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animalhabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
dev.off()


cols <- c("green", "blue", "green", "blue", "green", "blue","green", "blue")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animalpollination.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wind_animalpollination.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13a$states,piecol=cols,cex=0.1)
dev.off()





#open_close_silica
pdffn = paste0("corHMMmodel_open_close_silica.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic13b.2, rate.cat = 2, color = "col.blind" )
dev.off()

#"0_0" "0_1" "1_0" "1_1" 
cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2rates_open_close_silica.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic13b.2$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Open Close Silica ARD and R1/R2 rates")
dev.off()

trait <- paste(trait13[,2],trait13[,4], sep = "_") 
names(trait) <- trait13[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_open_close_silica.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silica.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silica.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
dev.off()

#1     2     3     4 
#"0_0" "0_1" "1_0" "1_1" 
#(1,R1)      (2,R1)      (3,R1)       (4,R1)      (1,R2)      (2,R2)      (3,R2)  (4,R2)

cols <- c("orange", "orange", "orange", "orange", "grey", "grey", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silicarates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silicarates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("pink", "pink", "brown", "brown", "pink", "pink", "brown", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silicahabitat.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silicahabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
dev.off()


cols <- c("green", "blue", "green", "blue", "green", "blue","green", "blue")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silicasilica.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_silicasilica.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13b.2$states,piecol=cols,cex=0.1)
dev.off()



#open_close_wet_dry
pdffn = paste0("corHMMmodel_open_close_wet_dry.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic13c, rate.cat = 2, color = "col.blind" )
dev.off()

#"0_0" "0_1" "1_0" "1_1" 
cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2rates_open_close_wet_dry.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic13c$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Open Close Wet Dry ARD and R1/R2 rates")
dev.off()

trait <- paste(trait13[,2],trait13[,5], sep = "_") 
names(trait) <- trait13[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_open_close_wet_dry.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_dry.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_dry.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
dev.off()

#1     2     3     4 
#"0_0" "0_1" "1_0" "1_1" 
#(1,R1)      (2,R1)      (3,R1)       (4,R1)      (1,R2)      (2,R2)      (3,R2)  (4,R2)

cols <- c("orange", "orange", "orange", "orange", "grey", "grey", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_dryrates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_dryrates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("pink", "pink", "brown", "brown", "pink", "pink", "brown", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_dryhabitat.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_dryhabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
dev.off()


cols <- c("green", "blue", "green", "blue", "green", "blue","green", "blue")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_drywetness.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_wet_drywetness.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13c$states,piecol=cols,cex=0.1)
dev.off()


#open_close_epiphyte
pdffn = paste0("corHMMmodel_open_close_epiphyte.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic13d, rate.cat = 2, color = "col.blind" )
dev.off()

#"0_0" "0_1" "1_0" "1_1" 
cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2rates_open_close_epiphyte.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic13d$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Open Close Epiphyte ARD and R1/R2 rates")
dev.off()

trait <- paste(trait13[,2],trait13[,6], sep = "_") 
names(trait) <- trait13[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_open_close_epiphyte.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("white", "black", "blue", "purple", "red", "yellow", "orange", "green")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphyte.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphyte.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
dev.off()

#1     2     3     4 
#"0_0" "0_1" "1_0" "1_1" 
#(1,R1)      (2,R1)      (3,R1)       (4,R1)      (1,R2)      (2,R2)      (3,R2)  (4,R2)

cols <- c("orange", "orange", "orange", "orange", "grey", "grey", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphyterates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphyterates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("pink", "pink", "brown", "brown", "pink", "pink", "brown", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphytehabitat.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphytehabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
dev.off()


cols <- c("green", "blue", "green", "blue", "green", "blue","green", "blue")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphyteepiphyte.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_close_epiphyteepiphyte.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F,cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic13d$states,piecol=cols,cex=0.1)
dev.off()





#open_close

pdffn = paste0("corHMMmodel_open_closed.pdf")
pdf(file=pdffn, width=8, height=8)
plotMKmodel(pp.polymorphic12c, rate.cat = 2, color = "col.blind")
dev.off()

cols <- c("red", "yellow","white", "black")
pdffn = paste0("polymorphicARDandR1R2rates_open_closed.pdf")
pdf(file=pdffn, width=6, height=200)
plotRECON(mytree,pp.polymorphic12c$states,piecolors=cols, cex=0.2, pie.cex=0.3, show.tip.label=TRUE, title="Open Close ARD and R1/R2 rates")
dev.off()

trait <- trait12[,2]
names(trait) <- trait12[,1]
pdffn = paste0("polymorphicARDandR1R2ratesv2_open_closed.pdf")
pdf(file=pdffn, width=6, height=200)
plot(mytree,type="phylogram",cex=0.2,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.3)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

cols <- c("red", "yellow","white", "black")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closed.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closed.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
dev.off()


# 1   2 
#"0" "1" 
# (1,R1)      (2,R1)     (1,R2)      (2,R2)
cols <- c("orange", "orange", "grey", "grey")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closerates.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closerates.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
dev.off()

cols <- c("pink", "brown", "pink", "brown")
pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closehabitat.pdf")
pdf(file=pdffn, width=100, height=100)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
add.simmap.legend(colors=cols,prompt=FALSE,x=0.9*par()$usr[1],
    y=0.8*par()$usr[3],fsize=2)
dev.off()

pdffn = paste0("polymorphicARDandR1R2ratesfan_open_closehabitat.jpg")
jpeg(file=pdffn, width=3500, height=3500)
plot(mytree,type="fan", show.tip.label = F, cex=1,font=3,lwd=0.5,label.offset = 1)
tiplabels(pie=to.matrix(trait[mytree$tip.label],
    levels(as.factor(trait))),piecol=cols,cex=0.1)
nodelabels(node=1:mytree$Nnode+Ntip(mytree),
    pie=pp.polymorphic12c$states,piecol=cols,cex=0.1)
dev.off()


```





